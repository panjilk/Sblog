# Sblog 开发记录

## 项目配置

- **前端端口**: 3000
- **后端端口**: 8081
- **代理前缀**: `/api`

## 前端请求流程

```
登录/注册
    ↓
表单验证
    ↓
调用 API (自动添加 /api 前缀)
    ↓
代理转发到 http://localhost:8081
    ↓
返回结果 (统一错误处理)
    ↓
保存 token / 跳转页面
```

## 后端接口格式要求

### 1. 登录接口

**接口地址**: `POST /api/login`

**请求参数**:
```json
{
  "username": "admin",
  "password": "123456"
}
```

**成功返回**:
```json
{
  "code": 200,
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  },
  "message": "登录成功"
}
```

**失败返回**:
```json
{
  "code": 401,
  "message": "用户名或密码错误"
}
```

---

### 2. 注册接口

**接口地址**: `POST /api/register`

**请求参数**:
```json
{
  "username": "admin",
  "password": "123456"
}
```

**成功返回**:
```json
{
  "code": 200,
  "message": "注册成功"
}
```

**失败返回**:
```json
{
  "code": 400,
  "message": "用户名已存在"
}
```

---

### 3. 获取用户信息

**接口地址**: `GET /api/user/info`

**请求头**:
```
Authorization: Bearer {token}
```

**成功返回**:
```json
{
  "code": 200,
  "data": {
    "id": 1,
    "username": "admin",
    "email": "admin@example.com"
  }
}
```

---

### 4. 退出登录

**接口地址**: `POST /api/logout`

**请求头**:
```
Authorization: Bearer {token}
```

**成功返回**:
```json
{
  "code": 200,
  "message": "退出成功"
}
```

---

## 状态码说明

| code | 说明 |
|------|------|
| 200 | 请求成功 |
| 400 | 请求参数错误 |
| 401 | 未授权/登录失效 |
| 403 | 拒绝访问 |
| 404 | 资源不存在 |
| 500 | 服务器错误 |

---

## Axios 封装使用

### 配置说明

| 配置项 | 值 | 说明 |
|--------|-----|------|
| baseURL | `/api` | 基础路径 |
| timeout | `10000` | 超时时间 10 秒 |

### 拦截器说明

#### 请求拦截器
- 自动从 localStorage 读取 token
- 自动添加到请求头：`Authorization: Bearer {token}`

#### 响应拦截器
- 统一处理错误提示
- 401 自动跳转登录页
- 返回 `res.data` 数据
- 根据状态码显示对应错误消息

### 使用方式

#### 1. 在组件中使用

```vue
<script setup>
import request from '@/utils/axios'

const handleLogin = async () => {
  try {
    const res = await request.post('/login', {
      username: 'admin',
      password: '123456'
    })
    // res 已经是 res.data，直接使用
    console.log(res.token)
    localStorage.setItem('token', res.token)
  } catch (error) {
    // 错误已被拦截器处理，这里可选
  }
}
</script>
```

#### 2. 创建 API 模块（推荐）

创建 `src/api/user.js`：

```js
import request from '@/utils/axios'

// 登录
export const login = (data) => {
  return request.post('/login', data)
}

// 注册
export const register = (data) => {
  return request.post('/register', data)
}

// 获取用户信息
export const getUserInfo = () => {
  return request.get('/user/info')
}

// 退出登录
export const logout = () => {
  return request.post('/logout')
}
```

在组件中使用：

```vue
<script setup>
import { login, register } from '@/api/user'

const handleLogin = async () => {
  const res = await login({
    username: 'admin',
    password: '123456'
  })
  localStorage.setItem('token', res.token)
}
</script>
```

#### 3. 常用请求方法

```js
import request from '@/utils/axios'

// GET 请求
request.get('/user/info')
request.get('/user/list', { params: { page: 1 } })

// POST 请求
request.post('/login', { username: 'admin', password: '123' })

// PUT 请求
request.put('/user/1', { name: 'new name' })

// DELETE 请求
request.delete('/user/1')
```

