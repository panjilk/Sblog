# SBlog-Java 后端学习指南

> 本文档面向后端小白，帮助你理解这个博客项目的核心要点和学习路径。

---

## 一、项目概览

### 1.1 技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Spring Boot | 4.0.2 | 核心框架 |
| Java | 17 | 编程语言 |
| Spring Data JPA | - | ORM框架（操作数据库） |
| Spring Security | - | 密码加密 |
| MySQL | - | 数据库 |
| Redis | - | 缓存中间件 |
| JWT | 0.11.5 | Token认证 |
| Lombok | - | 简化代码 |
| Maven | - | 项目构建 |

---

## 二、项目架构（重点理解）

### 2.1 分层架构

```
┌─────────────────────────────────────────────────────────┐
│  前端 (Vue.js)                                           │
└─────────────────────────────────────────────────────────┘
                            ↓ HTTP请求
┌─────────────────────────────────────────────────────────┐
│  Controller层 (控制器) - 接收请求、返回响应              │
│  例：UserController、ArticleController                   │
└─────────────────────────────────────────────────────────┘
                            ↓ 调用
┌─────────────────────────────────────────────────────────┐
│  Service层 (业务逻辑) - 处理业务                         │
│  例：UserServiceImpl、ArticleServiceImpl                 │
└─────────────────────────────────────────────────────────┘
                            ↓ 调用
┌─────────────────────────────────────────────────────────┐
│  Repository/DAO层 (数据访问) - 操作数据库                │
│  例：UserRepository、ArticleRepository                   │
└─────────────────────────────────────────────────────────┘
                            ↓ 操作
┌─────────────────────────────────────────────────────────┐
│  数据库 (MySQL/Redis)                                    │
└─────────────────────────────────────────────────────────┘
```

### 2.2 各层职责

| 层级 | 职责 | 示例 |
|------|------|------|
| **Controller** | 接收HTTP请求，参数校验，调用Service，返回响应 | 接收登录请求，返回Token |
| **Service** | 业务逻辑处理，调用Repository | 验证密码、生成Token |
| **Repository** | 数据库CRUD操作 | 根据用户名查询用户 |

---

## 三、核心概念详解

### 3.1 实体类 (Entity)

**作用**：对应数据库中的一张表

```java
@Entity  // 告诉JPA这是一个实体类
@Table(name = "users")  // 指定对应的表名
public class User {
    @Id  // 主键
    @GeneratedValue(strategy = GenerationType.IDENTITY)  // 自增
    private Long id;

    @Column(nullable = false, unique = true)  // 非空、唯一
    private String username;

    @Enumerated(EnumType.STRING)  // 枚举存为字符串
    private UserRole role;
}
```

### 3.2 Repository 接口

**作用**：操作数据库，不需要写实现类

```java
// 继承 JpaRepository 后自动获得 CRUD 方法
public interface UserRepository extends JpaRepository<User, Long> {
    // Spring Data JPA 会自动实现这个方法
    Optional<User> findByUsername(String username);

    // 自定义查询
    @Query("SELECT u FROM User u WHERE u.email = ?1")
    Optional<User> findByEmail(String email);
}
```

**常用方法**（继承自JpaRepository）：
- `save()` - 保存/更新
- `findById()` - 根据ID查询
- `findAll()` - 查询所有
- `deleteById()` - 删除

### 3.3 DTO (Data Transfer Object)

**作用**：前后端数据传输的对象，与实体类分离

```java
// 实体类包含密码，DTO不暴露给前端
@Entity
public class User {
    private String password;  // 敏感信息
}

// 只给前端看这些字段
public class UserDto {
    private Long id;
    private String username;
    private String avatar;
}
```

### 3.4 统一响应格式

```java
public class Result<T> {
    private int code;       // 状态码
    private String message; // 提示信息
    private T data;        // 返回数据

    // 成功响应
    public static <T> Result<T> success(T data) {
        return new Result<>(200, "success", data);
    }

    // 错误响应
    public static <T> Result<T> error(String message) {
        return new Result<>(500, message, null);
    }
}
```

---

## 四、重点知识点

### 4.1 JPA 注解（必学）

| 注解 | 用途 | 示例 |
|------|------|------|
| `@Entity` | 标记为实体类 | `@Entity public class User {}` |
| `@Table` | 指定表名 | `@Table(name = "users")` |
| `@Id` | 主键 | `@Id private Long id;` |
| `@GeneratedValue` | 主键生成策略 | `@GeneratedValue(strategy = GenerationType.IDENTITY)` |
| `@Column` | 字段配置 | `@Column(nullable = false, length = 50)` |
| `@OneToMany` | 一对多关系 | `@OneToMany private List<Article> articles;` |
| `@ManyToMany` | 多对多关系 | `@ManyToMany private List<Tag> tags;` |
| `@Enumerated` | 枚举存储方式 | `@Enumerated(EnumType.STRING)` |

### 4.2 依赖注入（必学）

```java
@Service
public class UserServiceImpl {

    @Autowired  // 自动注入，Spring帮你创建对象
    private UserRepository userRepository;

    // 或者用构造器注入（推荐）
    private final UserRepository userRepository;

    public UserServiceImpl(UserRepository userRepository) {
        this.userRepository = userRepository;
    }
}
```

### 4.3 JWT 认证流程（重点）

```
┌─────────┐                   ┌─────────┐                   ┌─────────┐
│  前端   │                   │  后端   │                   │  前端   │
└────┬────┘                   └────┬────┘                   └────┬────┘
     │                             │                             │
     │  1. 发送用户名密码           │                             │
     │────────────────────────────>│                             │
     │                             │                             │
     │                             │  2. 验证成功，生成Token      │
     │<────────────────────────────│                             │
     │  3. 返回Token               │                             │
     │                             │                             │
     │  4. 请求带Token             │                             │
     │────────────────────────────>│                             │
     │                             │  5. 验证Token，返回数据      │
     │<────────────────────────────│                             │
```

### 4.4 拦截器

```java
@Component
public class TokenInterceptor implements HandlerInterceptor {

    @Override
    public boolean preHandle(HttpServletRequest request,
                            HttpServletResponse response,
                            Object handler) {
        // 请求处理前执行，返回true继续，false中断
        String token = request.getHeader("Authorization");
        // 验证token...
        return true;
    }
}
```

---

## 五、学习路线建议

### 阶段一：理解基础（1-2周）

1. **Spring Boot 基础**
   - 项目结构
   - 依赖注入（@Autowired）
   - 配置文件（application.properties）

2. **RESTful API**
   - HTTP方法（GET/POST/PUT/DELETE）
   - 请求参数（@RequestParam、@RequestBody）
   - 响应格式

3. **JPA 基础**
   - 实体类映射
   - Repository 基本操作
   - 常用注解

### 阶段二：深入业务（2-3周）

1. **用户模块** - 从简单开始
   - 文件：`UserController.java`、`UserServiceImpl.java`
   - 理解：注册、登录流程
   - 练习：添加"忘记密码"功能

2. **文章模块** - 理解CRUD
   - 文件：`ArticleController.java`、`ArticleServiceImpl.java`
   - 理解：分页查询、多表关联
   - 练习：添加文章搜索功能

3. **认证模块** - 理解安全
   - 文件：`JwtUtil.java`、`TokenInterceptor.java`
   - 理解：Token生成与验证
   - 练习：添加Token刷新机制

### 阶段三：进阶提升（1-2周）

1. **Redis 缓存**
   - 文件：`RedisService.java`
   - 理解：为什么用缓存
   - 练习：缓存热门文章

2. **拦截器与过滤器**
   - 文件：`WebConfig.java`、`TokenInterceptor.java`
   - 理解：请求处理流程
   - 练习：添加访问日志拦截器

3. **异常处理**
   - 练习：添加全局异常处理

---

## 六、代码阅读顺序

建议按以下顺序阅读代码：

```
1. 启动类
   └── SBlogJavaApplication.java

2. 实体类（理解数据结构）
   ├── User.java              （用户）
   ├── Article.java           （文章）
   ├── Category.java          （分类）
   ├── Tag.java               （标签）
   ├── Comment.java           （评论）
   └── Message.java           （留言）

3. Repository层（数据访问）
   ├── UserRepository.java
   ├── ArticleRepository.java
   └── ...

4. Service层（业务逻辑）
   ├── UserServiceImpl.java    （先看这个，简单）
   ├── ArticleServiceImpl.java
   └── ...

5. Controller层（API接口）
   ├── UserController.java     （先看这个）
   ├── ArticleController.java
   └── ...

6. 工具类（辅助功能）
   ├── JwtUtil.java            （JWT工具）
   ├── Result.java             （统一响应）
   └── TokenInterceptor.java   （拦截器）
```

---

## 七、常见问题

### Q1: Repository接口不需要写实现类吗？
**A**: 不需要。Spring Data JPA会根据方法名自动生成实现，比如`findByUsername()`会自动生成`SELECT * FROM users WHERE username = ?`

### Q2: @Autowired 是干什么的？
**A**: 自动注入。你声明了一个变量，Spring会自动帮你创建对象并赋值，不用`new`。

### Q3: DTO和Entity有什么区别？
**A**:
- **Entity**：对应数据库表，包含所有字段
- **DTO**：前后端传输数据，只包含需要的字段（比如密码不会放在DTO里）

### Q4: JWT Token存在哪里？
**A**:
- 后端生成Token返回给前端
- 前端保存在localStorage
- 前端每次请求都在Header中携带Token
- 后端用拦截器验证Token

### Q5: 为什么用Redis？
**A**:
- 存储Token（退出登录时删除）
- 缓存热点数据（减少数据库压力）
- 后续可扩展：验证码、限流等

---

## 八、练习建议

### 初级练习
1. 添加"修改邮箱"功能
2. 添加"忘记密码"功能
3. 为文章添加"点赞"功能

### 中级练习
1. 实现文章浏览量Redis缓存
2. 添加全局异常处理
3. 实现接口请求日志记录

### 高级练习
1. 添加文件上传功能（头像、文章封面）
2. 实现角色权限管理
3. 添加邮件通知功能

---

## 九、推荐学习资源

### 官方文档
- [Spring Boot 官方文档](https://spring.io/projects/spring-boot)
- [Spring Data JPA 文档](https://spring.io/projects/spring-data-jpa)

### 在线教程
- Spring Boot入门教程（B站搜索）
- JPA实战教程
- JWT认证原理

### 实践建议
1. **边看边敲**：不要只看，要自己动手改代码
2. **调试运行**：用断点调试看代码执行流程
3. **写注释**：把不懂的地方写上注释
4. **画图理解**：画出流程图、类图帮助理解

---

## 十、项目文件清单

```
核心文件速查：

启动类：
├── SBlogJavaApplication.java          # 主启动类

配置：
├── application.properties             # 项目配置
├── RedisConfig.java                   # Redis配置
├── WebConfig.java                     # 拦截器配置

实体类：
├── User.java                          # 用户
├── Article.java                       # 文章
├── Category.java                      # 分类
├── Tag.java                           # 标签
├── Comment.java                       # 评论
├── Message.java                       # 留言

Controller：
├── UserController.java                # 用户登录注册
├── ArticleController.java             # 文章管理
├── AuthController.java                # 认证
└── ...（共11个）

Service：
├── UserServiceImpl.java               # 用户业务逻辑
├── ArticleServiceImpl.java            # 文章业务逻辑
└── ...（共11个）

工具类：
├── JwtUtil.java                       # JWT工具
├── RedisService.java                  # Redis工具
├── Result.java                        # 统一响应
└── TokenInterceptor.java              # Token拦截器
```

---

> **最后提醒**：学习后端最重要的是**动手实践**，不要怕出错，报错是最好的学习机会！
